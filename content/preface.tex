\chapter{前言}\label{chap:前言}
\setcounter{page}{1}
渲染是计算机图形学的基础组成部分。
最抽象地说，渲染是把三维场景描述转换为图像的过程。
动画算法、几何建模、材质贴图和计算机图形学其他领域
都须经某些渲染过程来可视化其结果。
从电影到游戏等，渲染无处不在，它为创作、娱乐和可视化开辟了新的领域。

早期的渲染研究重点解决基本问题，例如从给定视点确定哪些物体是可见的。
随着这些问题找到高效解法以及图形学其他领域的持续发展使得场景描述更加丰富逼真，
现代渲染已涵盖了广泛内容，包括物理学、天体物理学、天文学、生物学、心理学、感知研究、理论和应用数学。
渲染的跨学科性是它如此引人的原因之一。

本书以文档化代码的形式提供了构建一个完整的渲染系统所需的一批现代渲染算法。
包括封面在内\sidenote{译者注：本书封面作了更换，但和原书封面是同一组渲染结果。}，
本书几乎所有图像都由该软件渲染得到。
且生成这些图像的全部算法均有描述。
该pbrt系统按{\itshape 文学编程}的程序设计方法编写，
即把对系统的描述和实现源码结合在一起。
我们认为，用文学编程法介绍计算机图形学和计算机科学是非常合适的。
算法的一些微妙细节在实现之前往往很难弄清楚，
因此读实际代码更有利于充分理解它们。
我们相信，深入理解哪怕少量的算法也比跑马观花更能打牢进一步研究计算机图形学的基础。

除了阐明实践中如何实现算法外，交代其在完整简单软件系统中的上下文
同样有助于解决中型渲染系统的设计和实现问题。
渲染系统的基本抽象和接口设计对实现的优雅性和可扩展性有实质影响，
但本书不会讨论这类设计取舍。

pbrt和本书内容仅关注{\itshape 逼真渲染}，
它可定义为这样的图像生成任务：和相机拍摄的照片难以区分，
或者人类看后被激发的响应与看到实际场景时一致。
我们有许多理由关注逼真感。
逼真图像对电影特效工业至关重要，
因为计算机生成的图像经常必须和真实世界的镜头无缝结合。
娱乐应用中所有图像都是合成的，
逼真感是让观察者忘记所见场景并不实际存在的有效手段。
最后，逼真感为衡量渲染系统输出质量提供了定义合理的指标。

\section*{读者}\label{sec:读者}

本书主要面向三类读者。
第一类是学习计算机图形学课程的研究生或高年级本科生。
本书假定读者拥有大学入门级计算机图形学知识，
只会回顾一些关键概念，例如基本向量几何和变换。
对于没有编写过上万行源码程序的学生，
文学编程风格更能降低学习难度。
为了让读者领会为何要这样构建系统，
我们特别注意解释关键接口和抽象背后的设计考量。

第二类读者是计算机图形学研究人员。
本书为研究人员全面介绍了该领域，
pbrt源码提供了可用的构建基础（至少可使用一部分源码）。
对于其他领域的读者，
我们认为对透彻理解渲染也有助于了解相关背景。

最后一类读者是工业界软件开发者。
尽管这些读者可能很熟悉本书许多内容，
但阅读文学风格的算法解释也许能获取新的角度。
pbrt涵盖了大量高级或艰深算法的实现和技术，
例如细分曲面、蒙特卡罗采样算法、双向路径追踪、Metropolis采样和次表面散射；
经验丰富的渲染从业者应该会很感兴趣。
我们希望能激发这些读者去钻研一个完整而典型的渲染系统的兴趣。

\section*{概述和目标}\label{sec:概述和目标}

pbrt基于{\itshape 光线追踪}算法。
光线追踪是一项优雅的技术，起源于镜片制造。
19世纪Carl Friedrich Gau{\ss}就用透镜手动追踪光线。
计算机上的光线追踪算法跟随无穷小的光线穿过场景直到与曲面相交。
它给出了从特定位置和方向寻找第一个可见物体的简单方法，
这是许多渲染算法的基础。

pbrt的设计和实现贯彻了三个目标：{\itshape 完整性}、{\itshape 解说性}和基于{\itshape 物理性}。

完整性指系统不应缺少高质量商业渲染系统的关键功能。
这意味着要彻底解决重要的实际问题，
例如抗锯齿、稳定性、数值精度以及高效渲染复杂场景的能力。
在设计系统时一开始就应考虑到这些，
因为它们会对系统所有组件产生微妙影响，
且在实现后期阶段很难再改装到系统中。

第二个目标意味着我们着眼于可读性和清晰度，
精心选用算法、数据结构和渲染技术。
因为比起其他渲染系统，我们的实现要接受更多读者的检验，
所以我们尽力选择已知的最优算法并将其实现。
这个目标也要求系统要小到一个人能完全理解的程度。
我们用可扩展的架构实现了pbrt，
即系统核心采用精心设计的抽象基类，
且这些基类尽量实现足够多特定功能。
这样读者不用理解所有特定细节就能明白系统的基本结构。
这更易于钻研感兴趣的部分并跳过其他内容，
且不影响对系统整体配合的把握。

完整性和解说性目标之间是存在矛盾的。
涵盖所有可能有用的技术不仅让本书过于冗长，
而且对于大多数读者而言也太复杂。
针对万一pbrt缺少某项有用功能的情况，
我们尽量使架构便于增添功能而不用改变系统整体设计。

基于物理的渲染的基础是物理定律及其数学表达式。
pbrt的设计对所计算的量和实现的算法使用正确的物理单位。
这样配置后，pbrt能计算出{\itshape 物理正确}的图像；
它们像在真实世界场景中那样准确反映光照。
这样的好处是它为程序正确性提供了具体标准：
对于预期结果可用解析解计算的简单场景，
如果pbrt没有算出相同结果，我们就能知道实现一定有bug。
类似地，如果pbrt中基于物理光照的不同算法对同一场景给出了不同结果，
或者pbrt所得结果和另一个基于物理的渲染器不一致，
则它们中必有一个出错了。
最后，我们认为基于物理的渲染方法是有价值的，因为它是严格的。
当不清楚特定计算该如何执行时，物理学会给出确保一致的答案。

效率的优先度低于以上三个目标。
既然渲染系统生成一张图像通常要花费数分钟或小时，
效率显然是很重要的。
然而我们主要关注{\itshape 算法}层面的效率而非底层代码优化。
尽管系统中计算量集中的部分已尽力做了优化，
但有时明显而微小的优化会让位于清晰的代码组织。

在介绍pbrt和讨论其实现时，
我们希望传授多年来渲染研究和开发的经验教训。
编写好一个渲染器比串接一堆快速算法更需要付出；
让系统既灵活又稳定是项困难的任务。
随着增添越来越多的几何体或光源，
或者其他复杂维度上升，
系统的性能将逐渐下降。
严谨处理数值稳定性、
算法不浪费浮点精度也至关重要。

开发出解决所有这些问题的系统大有益处——
编写新的渲染器或向已有渲染器添加新功能并用它创作出以往无法生成的图片是多么地快乐。
我们编写本书最基本的目标就是给广大读者这样的机会。
我们鼓励读者在阅读本书时使用该系统渲染pbrt发行的示例场景。
每章末的习题会要求修改系统以加深对内部工作原理的理解，
或者完成添加新功能等更复杂的工程。

本书官网为\href{www.pbrt.org}{\ttfamily pbrt.org}，
可从该站获取pbrt最新版源码。
我们也会发布勘误、修复bug、新增渲染场景和补充材料。
遇到网站尚未列出的pbrt中的任何bug或行文错误
均发送到邮箱\href{mailto:bugs@pbrt.org}{\url{bugs@pbrt.org}}。
我们非常重视您的反馈\sidenote{译者注：我也欢迎您的反馈！详见扉页更新网址。}！

\section*{第一版和第二版的区别}\label{sec:第一版和第二版的区别}

{\itshape 详见英文原版}

\section*{第二版和第三版的区别}\label{sec:第二版和第三版的区别}

{\itshape 详见英文原版}

\section*{致谢}\label{sec:致谢}

{\itshape 详见英文原版}

\section*{出版}\label{sec:出版}

{\itshape 详见英文原版}

\section*{场景和模型}\label{sec:场景和模型}

{\itshape 详见英文原版}

\section*{关于封面}\label{sec:关于封面}

{\itshape 详见英文原版}

\section*{扩展阅读}\label{sec:扩展阅读0}

\citet{10.1093/comjnl/27.2.97}的论文《\emph{Literate Programming}》
描述了文学编程背后的主要思想以及他的{\ttfamily web}编程环境\sidenote{译者注：一种计算机编程语言系统。}。
开创性的\TeX 排版系统是用网络写成的并出版了一系列书籍\citep{10.5555/536126,10.5555/536123}。
最近，\citet{10.1145/164984}在《\citetitle{10.1145/164984}》中
以文学格式出版了图表算法集。
这些程序读起来很有趣，各个算法也展示得很好。
网站\url{www.literateprogramming.com}指向了许多关于文学编程的论文、程序以及大量系统；
自Knuth最初提出该思想以来，文学编程已经进行了许多改进。


我们所知的其他出版成书的文学程序只有对lcc编译器的实现——
由\citet{10.5555/555424}编写并出版的《\citetitle{10.5555/555424}》，
以及\citet{10.5555/1036653}关于MP3音频格式的书《\citetitle{10.5555/1036653}》。

